<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="åŒ—æµ·é“è‡ªé§•">
    <title>2025 åŒ—æµ·é“è‡ªé§•ä¹‹æ—… (Live)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { -webkit-tap-highlight-color: transparent; }
        :root { --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom); }
        .safe-pt { padding-top: var(--safe-top); }
        .safe-pb { padding-bottom: var(--safe-bottom); }
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-print-color-adjust: exact;
            appearance: none;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
        .checkbox-wrapper input:checked + div { background-color: #06b6d4; border-color: #06b6d4; }
        .checkbox-wrapper input:checked + div svg { display: block; }
        
        /* é€£ç·šç‹€æ…‹æŒ‡ç¤ºç‡ˆ */
        .status-indicator { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .status-online { background-color: #10b981; box-shadow: 0 0 8px #10b981; }
        .status-offline { background-color: #ef4444; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans antialiased">
    <div id="root">
        <div class="min-h-screen flex flex-col items-center justify-center text-slate-400 space-y-4 safe-pb">
            <div class="w-10 h-10 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-sm font-medium">æ­£åœ¨é€£ç·šè‡³é›²ç«¯...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // ğŸ”¥ æ‚¨çš„ Firebase Config å·²æ•´åˆ ğŸ”¥
        // ==========================================
        const firebaseConfig = {
          apiKey: "AIzaSyATJ60tAJTkqr5bhmDkBMjEIumKyKDHITI",
          authDomain: "hokkaido-trip-2025-9ead5.firebaseapp.com",
          projectId: "hokkaido-trip-2025-9ead5",
          storageBucket: "hokkaido-trip-2025-9ead5.firebasestorage.app",
          messagingSenderId: "891716746902",
          appId: "1:891716746902:web:cbe157752df6dea04a4cb7"
        };

        // åˆå§‹åŒ– Firebase (ä½¿ç”¨ Compat èªæ³•)
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", error);
        }

        // --- Icons ---
        const Hotel = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 21h18"/><path d="M5 21V7l8-4 8 4v14"/><path d="M9 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/><path d="M9 21v-5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v5"/></svg>;
        const Utensils = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>;
        const Car = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/><path d="M14 17h-2"/></svg>;
        const MapPin = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>;
        const Navigation = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>;
        const ArrowLeft = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const Snowflake = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/><path d="m20 20-4-4"/><path d="m4 4 4 4"/><path d="m4 20 4-4"/><path d="m20 4-4 4"/></svg>;
        const PlaneIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 12h20"/><path d="M13 2l9 10-9 10"/><path d="M2 12l5-5m0 10l-5-5"/></svg>;
        const TreeIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 2L3 14h5v8h8v-8h5L12 2z"/></svg>;
        const MoneyIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>;
        const SettingsIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const ExternalLink = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>;
        const ShoppingBagIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>;
        const PlusIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const TrashIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>;
        const CheckIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg>;
        const PhotoIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>;
        const XIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const ChevronRight = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 18 6-6-6-6"/></svg>;
        const ChevronLeft = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m15 18-6-6 6-6"/></svg>;
        const ShareIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>;

        // --- Data (åŒ—æµ·é“è©³ç´°è¡Œç¨‹) ---
        const itineraryData = [
          { date: "2025-12-22", city: "Sapporo", hotel: "Quintessa Hotel Sapporo", activities: [ { id: "d1-1", time: "09:00", type: "transit", name: "TSA æ¾å±±æ©Ÿå ´èµ·é£›", notes: "âœˆï¸ JL0096 (JAL) / è¡Œæ: 2ä»¶" }, { id: "d1-2", time: "13:00", type: "transit", name: "æŠµé”æ±äº¬ç¾½ç”° (HND)", notes: "âš ï¸ éœ€å…¥å¢ƒé ˜è¡Œæ â” è½‰åœ‹å…§ç·šæ›è¡Œæ (T3 -> T1)" }, { id: "d1-3", time: "15:30", type: "transit", name: "HND ç¾½ç”°èµ·é£›", notes: "âœˆï¸ JL0521 (åœ‹å…§ç·š)" }, { id: "d1-4", time: "17:05", type: "transit", name: "æŠµé”æ–°åƒæ­² (CTS)", notes: "åˆ†ç§’å¿…çˆ­ï¼æ´¾äººå…ˆè¡ç§Ÿè»Šæ«ƒå°" }, { id: "d1-5", time: "17:30", type: "transit", name: "SUZUKI ç§Ÿè»Šå–è»Š", notes: "â˜… è¨‚å–®: JS2501896 (åœ‹å…§ç·šæ«ƒå°) / 18:00å‰å‹™å¿…æŠµé”" }, { id: "d1-6", time: "Drive", type: "transit", name: "å‰å¾€æœ­å¹Œå¸‚å€", notes: "è»Šç¨‹ç´„ 1 å°æ™‚ (æ³¨æ„é›ªåœ°é§•é§›)" }, { id: "d1-7", time: "Check-in", type: "hotel", name: "Quintessa Hotel Sapporo", notes: "â˜… è¨‚å–®: 6840839171 (PIN: 4589) / ç¢ºèªåœè»Šä½" }, { id: "d1-8", time: "Dinner", type: "dinner", name: "æœ­å¹Œæ¹¯å’–å“©", notes: "é£¯åº—é™„è¿‘ï¼šSuage+ æˆ– Samurai" } ] },
          { date: "2025-12-23", city: "Sapporo", hotel: "Quintessa Hotel Sapporo", activities: [ { id: "d2-1", time: "09:30", type: "sightseeing", name: "Snow Cruise ONZE", notes: "ğŸ¿ æ»‘é›ªå›‰! (è¨‚å–®: 251108075341000650) / æµ·æ™¯æ»‘é›ªå ´" }, { id: "d2-2", time: "15:30", type: "transit", name: "æ»‘é›ªçµæŸ / è¿”å›æœ­å¹Œ", notes: "ğŸš— è»Šç¨‹ç´„ 40 åˆ†" }, { id: "d2-3", time: "Dinner", type: "dinner", name: "è–„é‡ (Susukino)", notes: "æ‹‰éºµæ©«ä¸æˆ–å±…é…’å±‹" }, { id: "d2-4", time: "Shopping", type: "shopping", name: "å”å‰è¨¶å¾· / è—¥å¦", notes: "ç‹¸å°è·¯é€›è¡—" } ] },
          { date: "2025-12-24", city: "Sapporo", hotel: "Quintessa Hotel Sapporo", activities: [ { id: "d3-1", time: "09:30", type: "sightseeing", name: "Snow Cruise ONZE", notes: "ğŸ¿ Day 2 æ»‘é›ª (è¨‚å–®: 251108075341000650)" }, { id: "d3-2", time: "15:05", type: "transit", name: "ç¬¬äºŒæ‰¹äººå“¡æŠµé”", notes: "âœˆï¸ JL3107 æŠµé”æ–°åƒæ­²" }, { id: "d3-3", time: "16:30", type: "transit", name: "ç¬¬äºŒæ‰¹å‰å¾€é£¯åº—", notes: "ğŸš† æ­ JR å¿«é€Ÿ Airport è‡³æœ­å¹Œç«™ â” è½‰è»Šè‡³é£¯åº—" }, { id: "d3-4", time: "17:30", type: "hotel", name: "å…¨å“¡é£¯åº—æœƒåˆ", notes: "Quintessa Hotel / âš ï¸ç¬¬äºŒé§•é§›å»ºè­°ä¹‹å¾Œå†è£œè¾¦" }, { id: "d3-5", time: "Dinner", type: "dinner", name: "è–èª•æ™šé¤", notes: "æ…¶ç¥å…¨å“¡åˆ°é½Šï¼(é¤å»³æˆ–è–èª•å¸‚é›†)" } ] },
          { date: "2025-12-25", city: "Sapporo", hotel: "Quintessa & LIT'S INN", activities: [ { id: "d4-1", time: "10:30", type: "transit", name: "é€€æˆ¿ / å‡ºç™¼", notes: "ğŸš— å‰å¾€ä¸‰äº• Outlet (è¡Œæå…¨ä¸Šè»Š)" }, { id: "d4-2", time: "11:10", type: "shopping", name: "ä¸‰äº• Outlet åŒ—å»£å³¶", notes: "é€›è¡—åƒåˆé¤ (å®¤å…§å‹é¿å¯’)" }, { id: "d4-3", time: "13:40", type: "transit", name: "å‰å¾€æ–°åƒæ­²æ©Ÿå ´", notes: "ğŸš— æ¥æ©Ÿ / âš ï¸ æ³¨æ„è¡Œæç©ºé–“" }, { id: "d4-4", time: "14:20", type: "transit", name: "ç¬¬ä¸‰æ‰¹äººå“¡æŠµé”", notes: "âœˆï¸ æ˜Ÿå®‡ JX850 (T1 09:20èµ·é£›)" }, { id: "d4-5", time: "15:10", type: "transit", name: "åœ‹éš›ç·šæ¥æ©Ÿ", notes: "å…¥å¢ƒç´„éœ€ 50 åˆ† / å»ºè­°åœ B åœè»Šå ´" }, { id: "d4-6", time: "16:30", type: "hotel", name: "LIT'S INN Sapporo", notes: "ğŸŸ¢ å…¨å“¡åˆ°é½Š / è¾¦ç†å…¥ä½" }, { id: "d4-7", time: "17:30", type: "sightseeing", name: "æ…•å°¼é»‘è–èª•å¸‚é›†", notes: "ğŸ„ å¤§é€šå…¬åœ’ 2ä¸ç›® (æœ€å¾Œä¸€æ™š! è‡³ 21:00)" }, { id: "d4-8", time: "18:30", type: "sightseeing", name: "ç™½è‰²ç‡ˆæ¨¹ç¯€", notes: "âœ¨ White Illumination (å¤§é€š 1-6ä¸ç›®)" }, { id: "d4-9", time: "Dinner", type: "dinner", name: "è–èª•æ™šé¤", notes: "å¸‚é›†å°åƒ or è–„é‡å¤§é¤" } ] },
          { date: "2025-12-26", city: "Sapporo", hotel: "Quintessa & LIT'S INN", activities: [ { id: "d5-1", time: "08:30", type: "lunch", name: "äºŒæ¢å¸‚å ´", notes: "æ—©é¤åƒè±ªè¯æµ·é®®ä¸¼ / è³¼è²·ä¹¾è²¨" }, { id: "d5-2", time: "09:45", type: "sightseeing", name: "åŒ—æµ·é“å¤§å­¸", notes: "ğŸ« å…‹æ‹‰å…‹åƒ / ç™½é›ªæ ¡åœ’æ•£ç­– (éœ€åœæ­£é–€å¤–)" }, { id: "d5-3", time: "11:00", type: "sightseeing", name: "åŒ—æµ·é“ç¥å®®", notes: "â›©ï¸ é›ªä¸­åƒæ‹œ / å¿…åƒå…­èŠ±äº­åˆ¤å®˜é¤…" }, { id: "d5-4", time: "12:30", type: "sightseeing", name: "ç™½è‰²æˆ€äººå…¬åœ’", notes: "ğŸª æ­é¢¨åŸå ¡æ‹ç…§ / åœ’å€å…§åˆé¤" }, { id: "d5-5", time: "15:30", type: "transit", name: "å‰å¾€è—»å²©å±±", notes: "ğŸš— ææ—©å‡ºç™¼é¿é–‹ä¸‹ç­è»Šæ½®" }, { id: "d5-6", time: "16:00", type: "sightseeing", name: "è—»å²©å±±å¤œæ™¯", notes: "ğŸš  å¿…çœ‹! æ—¥æœ¬æ–°ä¸‰å¤§å¤œæ™¯ (æ—¥è½å‰æŠµé”)" }, { id: "d5-7", time: "18:30", type: "sightseeing", name: "æœ­å¹Œé›»è¦–å¡”", notes: "ğŸ—¼ ä¿¯ç°å¤§é€šå…¬åœ’å¤œæ™¯" }, { id: "d5-8", time: "Dinner", type: "dinner", name: "æœ­å¹Œå¸‚å€æ™šé¤", notes: "æˆå‰æ€æ±—çƒ¤è‚‰ / èƒèŸ¹æ–™ç†" } ] },
          { date: "2025-12-27", city: "Otaru", hotel: "STAY's OTARU", activities: [ { id: "d6-1", time: "10:00", type: "transit", name: "é€€æˆ¿ / å‡ºç™¼å°æ¨½", notes: "ğŸš— æœ­æ¨½é“ç´„ 50 åˆ†é˜" }, { id: "d6-2", time: "11:00", type: "hotel", name: "STAY's OTARU", notes: "è¾¦ç†å…¥ä½æˆ–å…ˆå¯„æ”¾è¡Œæ / é™„è¨­åœè»Šå ´" }, { id: "d6-3", time: "12:30", type: "lunch", name: "ä¸‰è§’å¸‚å ´", notes: "åˆé¤ï¼šæµ·é®®ä¸¼ (æ­¦ç”°é®®é­šåº—/æ»æ³¢é£Ÿå ‚)" }, { id: "d6-4", time: "14:00", type: "sightseeing", name: "å°æ¨½éŸ³æ¨‚ç›’åšç‰©é¤¨æœ¬é¤¨", notes: "ğŸµ æ²¿å ºç”ºé€šé–‹å§‹æ­¥è¡Œ" }, { id: "d6-5", time: "15:00", type: "shopping", name: "å…­èŠ±äº­ / åŒ—è“æ¨“", notes: "è³¼è²·ä¼´æ‰‹ç¦® / å¤¢ä¸æ€è­°æ³¡èŠ™ / è‘¡è„å¥¶æ²¹å¤¾å¿ƒ" }, { id: "d6-6", time: "16:00", type: "sightseeing", name: "LeTAO Pathos", notes: "ğŸ° é©åˆåä¸‹ä¾†å–ä¸‹åˆèŒ¶ã€ä¼‘æ¯é¿å¯’" }, { id: "d6-7", time: "17:30", type: "sightseeing", name: "å‡ºæ‹”å°è·¯", notes: "æ‹ç…§ / å°åƒé»å¿ƒï¼Œèµ°åˆ°é‹æ²³é‚Š" }, { id: "d6-8", time: "18:00", type: "sightseeing", name: "å°æ¨½é‹æ²³ (é»ç‡ˆå¤œæ™¯)", notes: "ğŸ“¸ å¿…æ‹ï¼æ·ºè‰æ©‹æ‹æ”é»" }, { id: "d6-9", time: "19:00", type: "sightseeing", name: "å¤©ç‹—å±±å¤œæ™¯", notes: "ğŸš  é–‹è»Šä¸Šå±±åˆ°çºœè»Šç«™ (è¦–é›ªæ³è€Œå®š)" }, { id: "d6-10", time: "Dinner", type: "dinner", name: "å°æ¨½å¸‚å€æ™šé¤", notes: "æ¨è–¦ï¼šè‹¥é›æ™‚ä»£ (ç‚¸åŠé›) æˆ–æ”¿å£½å¸" } ] },
          { date: "2025-12-28", city: "Shiraoi", hotel: "Hoshino Resorts KAI Poroto", activities: [ { id: "d7-1", time: "10:00", type: "sightseeing", name: "æœé‡Œè»Šç«™", notes: "ğŸš è‡¨æµ·ç„¡äººè»Šç«™ / é †è·¯æ‹ç…§" }, { id: "d7-2", time: "11:30", type: "shopping", name: "ä¸‰äº• Outlet Park", notes: "ğŸ›ï¸ åŒ—å»£å³¶ (é †è·¯å—ä¸‹ï¼Œé«˜é€Ÿå…¬è·¯æ—)" }, { id: "d7-3", time: "Lunch", type: "lunch", name: "Outlet å…§ç”¨é¤", notes: "ç¾é£Ÿå»£å ´è§£æ±ºåˆé¤" }, { id: "d7-4", time: "14:00", type: "transit", name: "å‰å¾€æ˜Ÿé‡ ç•Œ æ³¢ç¾…å¤š", notes: "ğŸš— è»Šç¨‹ç´„ 1 å°æ™‚ 20 åˆ† (èµ°é«˜é€Ÿå…¬è·¯)" }, { id: "d7-5", time: "15:30", type: "hotel", name: "æ˜Ÿé‡é›†åœ˜ ç•Œ æ³¢ç¾…å¤š", notes: "â˜… Check-in / äº«å—æ¹–ç•”æ‘©çˆ¾æº«æ³‰" }, { id: "d7-6", time: "Dinner", type: "dinner", name: "é£¯åº—æ™šé¤", notes: "ğŸ± åŒ—æµ·é“å­£ç¯€æ‡·çŸ³æ–™ç†" } ] },
          { date: "2025-12-29", city: "Chitose", hotel: "", activities: [ { id: "d8-1", time: "Morning", type: "hotel", name: "ç•Œ æ³¢ç¾…å¤šæ™¨é–“æ´»å‹•", notes: "â™¨ï¸ æ³¡æº«æ³‰ / æ¹–ç•”æ•£æ­¥" }, { id: "d8-2", time: "10:30", type: "transit", name: "å‰å¾€æ–°åƒæ­²æ©Ÿå ´", notes: "ğŸš— è»Šç¨‹ç´„ 50 åˆ†é˜" }, { id: "d8-3", time: "11:30", type: "transit", name: "åŠ æ²¹ & ç§Ÿè»Šå…¬å¸é‚„è»Š", notes: "ğŸ SUZUKI æ«ƒå°åœ¨åœ‹å…§ç·šèˆªå»ˆ" }, { id: "d8-4", time: "12:00", type: "shopping", name: "æ©Ÿå ´åœ‹å…§ç·šèˆªå»ˆ", notes: "ğŸ›ï¸ æœ€å¾Œæ¡è²· (å“†å•¦Aå¤¢/Royce/å…­èŠ±äº­)" }, { id: "d8-5", time: "13:00", type: "transit", name: "åœ‹éš›ç·šæ«ƒå°å ±åˆ°", notes: "â° é ç•™å……è£•æ™‚é–“" } ] }
        ];

        // ç¯„ä¾‹ç›¸ç°¿è³‡æ–™
        const photoGallery = [
            { id: 1, url: "https://images.unsplash.com/photo-1548263594-a71e7f71e439?q=80&w=1000&auto=format&fit=crop", caption: "æœ­å¹Œå¤§é€šå…¬åœ’" },
            { id: 2, url: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=1000&auto=format&fit=crop", caption: "å°æ¨½é‹æ²³å¤œæ™¯" },
            { id: 3, url: "https://images.unsplash.com/photo-1612294027725-7b3b08e77242?q=80&w=1000&auto=format&fit=crop", caption: "åŒ—æµ·é“ç¥å®®" },
            { id: 4, url: "https://images.unsplash.com/photo-1516466723877-e462d73008e9?q=80&w=1000&auto=format&fit=crop", caption: "æ–°åƒæ­²æ©Ÿå ´" },
            { id: 5, url: "https://images.unsplash.com/photo-1578271887552-5ac3a72752bc?q=80&w=1000&auto=format&fit=crop", caption: "æ»‘é›ªå ´" },
        ];

        const cityColors = { Sapporo: "bg-blue-100 text-blue-800 border-blue-200", Otaru: "bg-cyan-100 text-cyan-800 border-cyan-200", Shiraoi: "bg-stone-100 text-stone-800 border-stone-200", Chitose: "bg-slate-100 text-slate-800 border-slate-200" };
        const cityBadges = { Sapporo: "â„ï¸ æœ­å¹Œ", Otaru: "ğŸŒŠ å°æ¨½", Shiraoi: "â™¨ï¸ ç™½è€", Chitose: "âœˆï¸ åƒæ­²" };

        const GalleryModal = ({ photos, isOpen, onClose }) => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [touchStart, setTouchStart] = useState(null);
            const [touchEnd, setTouchEnd] = useState(null);
            useEffect(() => { if (isOpen) setCurrentIndex(0); }, [isOpen]);
            if (!isOpen) return null;
            const minSwipeDistance = 50;
            const onTouchStart = (e) => { setTouchEnd(null); setTouchStart(e.targetTouches[0].clientX); }
            const onTouchMove = (e) => setTouchEnd(e.targetTouches[0].clientX);
            const onTouchEnd = () => {
                if (!touchStart || !touchEnd) return;
                const distance = touchStart - touchEnd;
                const isLeftSwipe = distance > minSwipeDistance;
                const isRightSwipe = distance < -minSwipeDistance;
                if (isLeftSwipe && currentIndex < photos.length - 1) setCurrentIndex(c => c + 1);
                if (isRightSwipe && currentIndex > 0) setCurrentIndex(c => c - 1);
            }
            return (
                <div className="fixed inset-0 z-[60] bg-black text-white flex flex-col animate-fadeIn">
                    <div className="flex justify-between items-center p-4 bg-black/50 backdrop-blur-md absolute top-0 w-full z-10 safe-pt">
                        <span className="font-bold text-sm">{currentIndex + 1} / {photos.length}</span>
                        <button onClick={onClose} className="p-2 rounded-full bg-white/20 hover:bg-white/30"><XIcon className="w-6 h-6" /></button>
                    </div>
                    <div className="flex-1 flex items-center justify-center relative overflow-hidden" onTouchStart={onTouchStart} onTouchMove={onTouchMove} onTouchEnd={onTouchEnd}>
                        <div className="relative w-full h-full flex items-center justify-center">
                            <img src={photos[currentIndex].url} alt={photos[currentIndex].caption} className="max-h-full max-w-full object-contain" />
                        </div>
                    </div>
                    <div className="p-6 bg-gradient-to-t from-black via-black/80 to-transparent pb-12 safe-pb absolute bottom-0 w-full">
                        <p className="text-center font-bold text-lg">{photos[currentIndex].caption}</p>
                    </div>
                </div>
            );
        };

        function HokkaidoTripApp() {
          const [filterCity, setFilterCity] = useState('All');
          const [selectedDate, setSelectedDate] = useState(null);
          const [expenses, setExpenses] = useState({});
          const [showExpenseInput, setShowExpenseInput] = useState(null);
          const [exchangeRate, setExchangeRate] = useState(0.215);
          const [showSettings, setShowSettings] = useState(false);
          const [showShopping, setShowShopping] = useState(false);
          const [showGallery, setShowGallery] = useState(false);
          const [shoppingList, setShoppingList] = useState([]);
          const [newItemName, setNewItemName] = useState("");
          const [calcAmount, setCalcAmount] = useState("");
          const [isOnline, setIsOnline] = useState(false);

          // é›²ç«¯åŒæ­¥
          useEffect(() => {
            if (!db) {
                // Fallback to local storage if firebase not configured
                const localExp = localStorage.getItem('hokkaido_expenses_2025');
                const localList = localStorage.getItem('hokkaido_shopping_list_2025');
                if(localExp) setExpenses(JSON.parse(localExp));
                if(localList) setShoppingList(JSON.parse(localList));
                return;
            }

            const docRef = db.collection('hokkaido2025').doc('tripData');
            
            // ç›£è½å³æ™‚æ›´æ–°
            const unsubscribe = docRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    setExpenses(data.expenses || {});
                    setShoppingList(data.shoppingList || []);
                    setIsOnline(true);
                } else {
                    // åˆå§‹åŒ–è³‡æ–™
                    docRef.set({ expenses: {}, shoppingList: [] });
                    setIsOnline(true);
                }
            }, (error) => {
                console.error("Sync Error:", error);
                setIsOnline(false);
            });

            return () => unsubscribe();
          }, []);

          // é›²ç«¯å¯«å…¥ï¼šè¨˜å¸³
          const saveExpense = (id, amount) => {
            const newExpenses = { ...expenses, [id]: parseInt(amount) || 0 };
            setExpenses(newExpenses);
            setShowExpenseInput(null);
            if(db) db.collection('hokkaido2025').doc('tripData').update({ expenses: newExpenses });
            else localStorage.setItem('hokkaido_expenses_2025', JSON.stringify(newExpenses));
          };

          // é›²ç«¯å¯«å…¥ï¼šè³¼ç‰©æ¸…å–®
          const updateShoppingList = (newList) => {
              setShoppingList(newList);
              if(db) db.collection('hokkaido2025').doc('tripData').update({ shoppingList: newList });
              else localStorage.setItem('hokkaido_shopping_list_2025', JSON.stringify(newList));
          }

          const addShoppingItem = () => {
            if (!newItemName.trim()) return;
            const updatedList = [...shoppingList, { id: Date.now(), text: newItemName, checked: false }];
            updateShoppingList(updatedList);
            setNewItemName("");
          };

          const toggleShoppingItem = (id) => {
            const updatedList = shoppingList.map(item => item.id === id ? { ...item, checked: !item.checked } : item);
            updateShoppingList(updatedList);
          };

          const deleteShoppingItem = (id) => {
            const updatedList = shoppingList.filter(item => item.id !== id);
            updateShoppingList(updatedList);
          };

          const getTotalCost = () => Object.values(expenses).reduce((a, b) => a + b, 0);
          const getDaysUntilTrip = () => {
              const today = new Date();
              const tripDate = new Date("2025-12-22");
              const diffTime = tripDate - today;
              const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
              return diffDays > 0 ? diffDays : 0;
          };

          const shareToLine = () => {
            const totalJPY = getTotalCost();
            const totalTWD = Math.round(totalJPY * exchangeRate);
            let message = `ğŸ‡¯ğŸ‡µ åŒ—æµ·é“ä¹‹æ—…ç›®å‰èŠ±è²»ï¼š\n------------------\n`;
            let hotelCost = 0, foodCost = 0, otherCost = 0;
            itineraryData.forEach(day => {
                day.activities.forEach(act => {
                    const cost = expenses[act.id] || 0;
                    if(cost > 0) {
                        if(act.type === 'hotel') hotelCost += cost;
                        else if(act.type === 'dinner' || act.type === 'lunch') foodCost += cost;
                        else otherCost += cost;
                    }
                });
            });
            if(hotelCost > 0) message += `ğŸ¨ ä½å®¿: Â¥${hotelCost.toLocaleString()}\n`;
            if(foodCost > 0) message += `ğŸœ é¤é£²: Â¥${foodCost.toLocaleString()}\n`;
            if(otherCost > 0) message += `ğŸ‚ å…¶ä»–: Â¥${otherCost.toLocaleString()}\n`;
            message += `------------------\nğŸ’° ç¸½è¨ˆ: Â¥${totalJPY.toLocaleString()}\n(ç´„ NT$ ${totalTWD.toLocaleString()})`;
            window.open(`https://line.me/R/msg/text/?${encodeURIComponent(message)}`, '_blank');
          };

          const filteredData = filterCity === 'All' ? itineraryData : itineraryData.filter(item => item.city === filterCity);
          const scrollToDate = (date) => {
            const element = document.getElementById(`date-${date}`);
            if (element) {
                const offset = element.getBoundingClientRect().top + window.pageYOffset - 120;
                window.scrollTo({ top: offset, behavior: "smooth" });
            }
            setSelectedDate(date);
          };
          const openMap = (query) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');

          return (
            <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-36 max-w-md mx-auto shadow-2xl border-x border-slate-200 relative">
              {/* Header */}
              <div className="sticky top-0 z-50 bg-white/95 backdrop-blur-sm shadow-sm border-b border-slate-200 safe-pt">
                <div className="px-4 py-3 flex justify-between items-center">
                  <div>
                    <h1 className="text-xl font-extrabold text-slate-800 flex items-center gap-2 tracking-tight">
                      <Snowflake className="w-6 h-6 text-cyan-500" />
                      åŒ—æµ·é“è‡ªé§•
                      <span className={`status-indicator ml-2 ${isOnline ? 'status-online' : 'status-offline'}`} title={isOnline ? "å·²é€£ç·šé›²ç«¯" : "é›¢ç·šæ¨¡å¼"}></span>
                    </h1>
                    <p className="text-xs text-slate-500 font-medium ml-0.5 mt-0.5">{getDaysUntilTrip() > 0 ? `è·é›¢å‡ºç™¼é‚„æœ‰ ${getDaysUntilTrip()} å¤©` : 'æ—…ç¨‹é€²è¡Œä¸­!'}</p>
                  </div>
                  <div className="relative">
                    <select value={filterCity} onChange={(e) => setFilterCity(e.target.value)} className="appearance-none bg-slate-100 border border-transparent hover:border-slate-300 rounded-full pl-4 pr-8 py-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-cyan-500 focus:outline-none cursor-pointer transition-all">
                      <option value="All">å…¨éƒ¨</option><option value="Sapporo">â„ï¸ æœ­å¹Œ</option><option value="Otaru">ğŸŒŠ å°æ¨½</option><option value="Shiraoi">â™¨ï¸ ç™½è€</option>
                    </select>
                  </div>
                </div>
                <div className="overflow-x-auto flex gap-2 px-4 py-3 no-scrollbar bg-white/95 border-t border-slate-50">
                    {filteredData.map((day) => {
                       const dayNum = new Date(day.date).getDate();
                       const dayName = new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' });
                       const isSelected = selectedDate === day.date;
                       return (
                         <button key={day.date} onClick={() => scrollToDate(day.date)} className={`flex flex-col items-center justify-center min-w-[3.6rem] h-14 rounded-2xl transition-all duration-200 border flex-shrink-0 ${isSelected ? 'bg-cyan-600 text-white shadow-md scale-105 border-cyan-600' : 'bg-white text-slate-500 border-slate-100 hover:border-slate-200'}`}>
                           <span className={`text-[10px] font-bold uppercase tracking-wider ${isSelected ? 'text-cyan-100' : 'text-slate-400'}`}>{dayName}</span><span className="text-lg font-bold leading-none mt-0.5">{dayNum}</span>
                         </button>
                       );
                    })}
                </div>
              </div>

              {/* Main Content */}
              <div className="px-4 pt-6 space-y-10">
                {filteredData.map((day) => (
                  <div key={day.date} id={`date-${day.date}`} className="relative animate-fadeIn">
                    <div className="flex items-center gap-3 mb-5 sticky top-32 z-30 bg-slate-50/95 py-3 backdrop-blur-sm border-b border-slate-100/50">
                      <div className={`px-3 py-1 rounded-full text-xs font-bold border shadow-sm ${cityColors[day.city] || "bg-gray-100"}`}>{cityBadges[day.city] || day.city}</div>
                      <h2 className="text-xl font-bold text-slate-800">{new Date(day.date).toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' })}</h2>
                    </div>
                    {day.hotel && (
                       <div className="mb-6 bg-white rounded-2xl p-4 flex items-start gap-4 border border-cyan-50 shadow-sm ring-1 ring-cyan-100/50">
                          <div className="bg-cyan-50 p-2 rounded-full text-cyan-600 shrink-0"><Hotel className="w-5 h-5" /></div>
                          <div className="flex-1"><div className="text-[10px] text-cyan-500 font-bold uppercase tracking-wider mb-0.5">ä½å®¿</div><div className="text-sm font-bold text-slate-900 leading-snug">{day.hotel}</div><button onClick={() => openMap(day.hotel + " " + day.city)} className="text-xs font-semibold text-cyan-600 mt-2 flex items-center gap-1 hover:text-cyan-800 bg-cyan-50 px-2 py-1 rounded-md w-fit transition-colors">å°èˆª <Navigation className="w-3 h-3 inline" /></button></div>
                       </div>
                    )}
                    <div className="relative border-l-2 border-slate-200 ml-4 space-y-8 pb-2">
                      {day.activities.map((activity, actIndex) => (
                        <div key={actIndex} className="relative pl-8">
                          <div className={`absolute -left-[9px] top-4 w-4 h-4 rounded-full border-[3px] border-slate-50 shadow-sm z-10 ${activity.type === 'dinner' || activity.type === 'lunch' ? 'bg-orange-400' : activity.type === 'transit' ? 'bg-slate-500' : 'bg-cyan-500'}`}></div>
                          <div className="bg-white rounded-2xl p-4 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100 hover:shadow-md transition-all active:scale-[0.98] active:bg-slate-50">
                            <div onClick={() => openMap(activity.name + " " + day.city)} className="cursor-pointer">
                                <div className="flex justify-between items-center mb-3">
                                   <span className={`text-[10px] font-bold px-2 py-1 rounded-md text-white shadow-sm ${activity.type === 'dinner' || activity.type === 'lunch' ? 'bg-orange-400' : activity.type === 'transit' ? 'bg-slate-500' : 'bg-cyan-500'}`}>{activity.time}</span>
                                   <span className="text-slate-400">
                                     {activity.name.includes("æ…•å°¼é»‘") || activity.name.includes("ç‡ˆæ¨¹") ? <TreeIcon className="w-4 h-4" /> : null}
                                     {(activity.name.includes("èµ·é£›") || activity.name.includes("æŠµé”")) && <PlaneIcon className="w-4 h-4" />}
                                     {activity.type === 'transit' && !activity.name.includes("èµ·é£›") && <Car className="w-4 h-4" />}
                                     {(activity.type === 'lunch' || activity.type === 'dinner') && <Utensils className="w-4 h-4" />}
                                     {(activity.type === 'sightseeing' || activity.type === 'shopping') && !activity.name.includes("æ…•å°¼é»‘") && <MapPin className="w-4 h-4" />}
                                     {activity.type === 'hotel' && <Hotel className="w-4 h-4" />}
                                   </span>
                                </div>
                                <h3 className="font-bold text-slate-800 text-base mb-1.5 leading-snug">{activity.name}</h3>
                                {activity.notes && <div className="bg-slate-50 rounded-lg p-2.5 mt-2"><p className="text-xs text-slate-600 font-medium leading-relaxed">{activity.notes}</p></div>}
                            </div>
                            <div className="mt-3 pt-3 border-t border-slate-50 flex items-center justify-between">
                                {showExpenseInput === activity.id ? (
                                    <div className="flex items-center gap-2 w-full animate-fadeIn"><span className="text-slate-400 text-sm">Â¥</span><input type="number" autoFocus placeholder="è¼¸å…¥é‡‘é¡" className="w-full bg-slate-50 border border-slate-200 rounded-lg px-2 py-1 text-sm outline-none focus:border-cyan-500" onBlur={(e) => saveExpense(activity.id, e.target.value)} onKeyDown={(e) => e.key === 'Enter' && saveExpense(activity.id, e.target.value)} defaultValue={expenses[activity.id] || ''} /></div>
                                ) : (
                                    <div className="flex justify-between w-full items-center">
                                        <div className="text-sm font-bold text-slate-700">{expenses[activity.id] ? `Â¥${expenses[activity.id].toLocaleString()}` : <span className="text-slate-300 text-xs">æœªè¨˜å¸³</span>}</div>
                                        <button onClick={() => setShowExpenseInput(activity.id)} className="p-1.5 rounded-full hover:bg-slate-100 text-slate-400 transition-colors"><MoneyIcon className="w-4 h-4" /></button>
                                    </div>
                                )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>

              {/* Footer Bar */}
              <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-slate-200 p-4 pb-8 z-40 safe-pb shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                  <div className="max-w-md mx-auto flex justify-between items-center gap-2">
                      <div className="flex-1"><div className="text-xs text-slate-500 font-bold mb-0.5">ç¸½èŠ±è²»</div><div className="text-xl font-extrabold text-cyan-600 leading-none">Â¥{getTotalCost().toLocaleString()}<span className="text-[10px] text-slate-400 font-medium ml-1 block mt-1">â‰ˆ NT$ {(getTotalCost() * exchangeRate).toLocaleString(undefined, {maximumFractionDigits:0})}</span></div></div>
                      <div className="flex gap-2">
                        <button onClick={() => setShowGallery(true)} className="bg-purple-50 p-3 rounded-full text-purple-600 hover:bg-purple-100 transition-colors shadow-sm"><PhotoIcon className="w-6 h-6" /></button>
                        <button onClick={() => setShowShopping(true)} className="bg-orange-50 p-3 rounded-full text-orange-600 hover:bg-orange-100 transition-colors shadow-sm"><ShoppingBagIcon className="w-6 h-6" /></button>
                        <button onClick={() => setShowSettings(true)} className="bg-slate-100 p-3 rounded-full text-slate-600 hover:bg-slate-200 transition-colors shadow-sm"><SettingsIcon className="w-6 h-6" /></button>
                      </div>
                  </div>
              </div>

              {/* Shopping Modal */}
              {showShopping && (
                <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fadeIn" onClick={() => setShowShopping(false)}>
                    <div className="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl h-[80vh] flex flex-col" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center border-b border-slate-100 pb-4 mb-4 shrink-0"><h3 className="text-lg font-bold text-slate-800 flex items-center gap-2"><ShoppingBagIcon className="w-5 h-5 text-orange-500" />è³¼ç‰©åŠ©æ‰‹</h3><button onClick={() => setShowShopping(false)} className="text-slate-400 hover:text-slate-600">âœ•</button></div>
                        <div className="bg-orange-50 rounded-xl p-4 mb-6 shrink-0"><label className="block text-xs font-bold text-orange-600/70 uppercase tracking-wider mb-2">å¿«é€Ÿæ›ç®— (åŒ¯ç‡ {exchangeRate})</label><div className="flex items-center gap-3"><span className="text-orange-900 font-bold">Â¥</span><input type="number" placeholder="è¼¸å…¥æ—¥å¹£..." value={calcAmount} onChange={(e) => setCalcAmount(e.target.value)} className="bg-white/50 w-full rounded-lg px-2 py-1 outline-none text-lg font-bold text-orange-900 placeholder:text-orange-900/30" /></div><div className="text-right mt-1 font-bold text-orange-700 text-sm">â‰ˆ NT$ {calcAmount ? (parseFloat(calcAmount) * exchangeRate).toLocaleString(undefined, {maximumFractionDigits:0}) : '0'}</div></div>
                        <div className="flex-1 overflow-y-auto no-scrollbar"><label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">å¿…è²·æ¸…å–®</label><div className="flex gap-2 mb-4"><input type="text" value={newItemName} onChange={(e) => setNewItemName(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && addShoppingItem()} placeholder="æ–°å¢é …ç›® (ä¾‹: EVEæ­¢ç—›è—¥)" className="flex-1 bg-slate-50 border border-slate-200 rounded-xl px-4 py-2 text-sm outline-none focus:border-orange-500" /><button onClick={addShoppingItem} className="bg-orange-500 text-white p-2 rounded-xl hover:bg-orange-600 transition-colors"><PlusIcon className="w-5 h-5" /></button></div><div className="space-y-2">{shoppingList.length === 0 && <div className="text-center text-slate-300 text-sm py-8">é‚„æ²’æœ‰æƒ³è²·çš„æ±è¥¿å—ï¼Ÿ</div>}{shoppingList.map(item => (<div key={item.id} className="flex items-center gap-3 bg-slate-50 p-3 rounded-xl border border-transparent hover:border-slate-200 transition-all"><label className="checkbox-wrapper relative flex items-center cursor-pointer"><input type="checkbox" checked={item.checked} onChange={() => toggleShoppingItem(item.id)} className="peer sr-only" /><div className="w-5 h-5 border-2 border-slate-300 rounded-md peer-checked:bg-orange-500 peer-checked:border-orange-500 transition-all flex items-center justify-center"><CheckIcon className="w-3 h-3 text-white hidden" /></div></label><span className={`flex-1 text-sm font-medium ${item.checked ? 'text-slate-400 line-through' : 'text-slate-700'}`}>{item.text}</span><button onClick={() => deleteShoppingItem(item.id)} className="text-slate-300 hover:text-red-400 transition-colors"><TrashIcon className="w-4 h-4" /></button></div>))}</div></div>
                    </div>
                </div>
              )}

              {/* Settings Modal */}
              {showSettings && (
                <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fadeIn" onClick={() => setShowSettings(false)}>
                    <div className="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl space-y-6" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center border-b border-slate-100 pb-4"><h3 className="text-lg font-bold text-slate-800">å·¥å…·ç®±</h3><button onClick={() => setShowSettings(false)} className="text-slate-400 hover:text-slate-600">âœ•</button></div>
                        <div><label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">åŒ¯ç‡è¨­å®š (JPY -> TWD)</label><div className="flex items-center gap-2 bg-slate-50 rounded-xl px-4 py-3 border border-slate-200"><span className="text-slate-400 font-bold">0.</span><input type="number" value={exchangeRate.toString().replace('0.', '')} onChange={(e) => { const val = parseFloat('0.' + e.target.value); setExchangeRate(val); localStorage.setItem('hokkaido_exchange_rate_2025', val); }} className="bg-transparent w-full outline-none font-bold text-slate-700" placeholder="215" /></div><p className="text-xs text-slate-400 mt-2 text-right">ç›®å‰åŒ¯ç‡: {exchangeRate}</p></div>
                        <div><label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">è‡ªé§•å¿…å‚™é€£çµ</label><div className="grid grid-cols-2 gap-3"><a href="https://www.jma.go.jp/bosai/snow/" target="_blank" className="flex flex-col items-center justify-center gap-2 bg-blue-50 hover:bg-blue-100 p-4 rounded-xl text-blue-700 transition-colors"><Snowflake className="w-6 h-6" /><span className="text-xs font-bold">é™é›ªé å ±</span></a><a href="https://info-road.hdb.hkd.mlit.go.jp/RoadInfo/index.htm" target="_blank" className="flex flex-col items-center justify-center gap-2 bg-slate-100 hover:bg-slate-200 p-4 rounded-xl text-slate-700 transition-colors"><Car className="w-6 h-6" /><span className="text-xs font-bold">å³æ™‚è·¯æ³</span></a><a href="https://mapcode.com/en/" target="_blank" className="flex flex-col items-center justify-center gap-2 bg-orange-50 hover:bg-orange-100 p-4 rounded-xl text-orange-700 transition-colors"><MapPin className="w-6 h-6" /><span className="text-xs font-bold">MapCode</span></a><button onClick={() => { const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(expenses)); const downloadAnchorNode = document.createElement('a'); downloadAnchorNode.setAttribute("href", dataStr); downloadAnchorNode.setAttribute("download", "expenses_backup.json"); document.body.appendChild(downloadAnchorNode); downloadAnchorNode.click(); downloadAnchorNode.remove(); }} className="flex flex-col items-center justify-center gap-2 bg-green-50 hover:bg-green-100 p-4 rounded-xl text-green-700 transition-colors"><ExternalLink className="w-6 h-6" /><span className="text-xs font-bold">å‚™ä»½è¨˜å¸³</span></button></div></div>
                        <div><label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">åˆ†äº«</label><button onClick={shareToLine} className="w-full flex items-center justify-center gap-2 bg-[#06C755] hover:bg-[#05b34c] text-white p-4 rounded-xl transition-colors font-bold"><ShareIcon className="w-5 h-5" /> åˆ†äº«å¸³ç›®åˆ° LINE</button></div>
                    </div>
                </div>
              )}

              {/* Gallery Modal */}
              <GalleryModal photos={photoGallery} isOpen={showGallery} onClose={() => setShowGallery(false)} />

              {/* FAB */}
              <button onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className="fixed bottom-24 right-6 bg-slate-900/90 text-white p-3.5 rounded-full shadow-xl hover:bg-black transition-all z-40 active:scale-90 backdrop-blur-sm safe-pb"><ArrowLeft className="w-6 h-6 rotate-90" /></button>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HokkaidoTripApp />);
    </script>
</body>
</html>
